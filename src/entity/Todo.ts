/**
 * Сущность Todo (Задача)
 * 
 * Определяет структуру таблицы задач в базе данных.
 * Каждая задача может быть привязана к пользователю (опционально)
 * и содержит информацию о тексте задачи, статусе выполнения
 * и временных метках создания/обновления.
 */

// Импорт декораторов TypeORM для определения структуры таблицы
import { Entity, PrimaryGeneratedColumn, Column, CreateDateColumn, UpdateDateColumn, ManyToOne, JoinColumn } from 'typeorm';
// Импорт сущности User для связи многие-к-одному
import { User } from './User';

/**
 * Декоратор Entity указывает, что класс представляет таблицу 'todos' в БД
 */
@Entity('todos')
export class Todo {
  /**
   * Уникальный идентификатор задачи
   * Генерируется автоматически как UUID при создании записи
   */
  @PrimaryGeneratedColumn('uuid')
  id!: string;

  /**
   * Текст задачи
   * Обязательное поле, не может быть пустым
   */
  @Column()
  text!: string;

  /**
   * Статус выполнения задачи
   * По умолчанию false (не выполнена)
   */
  @Column({ default: false })
  completed!: boolean;

  /**
   * Идентификатор пользователя, которому принадлежит задача
   * Опциональное поле - задача может быть без привязки к пользователю
   */
  @Column({ nullable: true })
  userId?: string;

  /**
   * Связь многие-к-одному с сущностью User
   * ManyToOne означает, что многие задачи могут принадлежать одному пользователю
   * onDelete: 'CASCADE' - при удалении пользователя автоматически удаляются его задачи
   * JoinColumn указывает имя внешнего ключа в таблице
   */
  @ManyToOne(() => User, { nullable: true, onDelete: 'CASCADE' })
  @JoinColumn({ name: 'userId' })
  user?: User;

  /**
   * Дата и время создания задачи
   * Автоматически устанавливается при создании записи
   */
  @CreateDateColumn()
  createdAt!: Date;

  /**
   * Дата и время последнего обновления задачи
   * Автоматически обновляется при изменении записи
   */
  @UpdateDateColumn()
  updatedAt!: Date;
}
